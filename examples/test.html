<h1 id="demos-eus-kerberos-ssl-and-oud-a-guideline">Demos EUS, Kerberos, SSL and OUD a guideline</h1>
<p>A couple of demo’s for the TechEvent presentation <em>EUS, Kerberos, SSL and OUD a guideline</em>. Be aware, that the code can not be used copy/past in all environments due to limitations on the line breaks.</p>
<p>Demos are shown on an Oracle 18c Docker based database.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">docker</span> run --detach --name te2018_eusdb \</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  --volume /data/docker/volumes/te2018_eusdb:/u01 \</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  -e ORACLE_SID=TE18EUS \</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  -p 1521:1521 -p 5500:5500 \</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  --hostname te2018_eusdb.postgasse.org \</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  --dns 192.168.56.70 \</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  --dns-search postgasse.org \</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  oracle/database:18.3.0.0</a></code></pre></div>
<p>Create user and roles</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">CREATE</span> <span class="kw">ROLE</span> tvd_connect;</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">SESSION</span> <span class="kw">TO</span> tvd_connect;</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">GRANT</span> <span class="kw">select</span> <span class="kw">ON</span> v_$session <span class="kw">TO</span> tvd_connect;</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">CREATE</span> <span class="fu">USER</span> SOE_KERBEROS <span class="kw">IDENTIFIED</span> <span class="kw">EXTERNALLY</span> <span class="kw">AS</span> <span class="st">&#39;soe@POSTGASSE.ORG&#39;</span>;</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">GRANT</span> tvd_connect <span class="kw">TO</span> SOE_KERBEROS;</a></code></pre></div>
<h2 id="password-verifier">Password Verifier</h2>
<p>Clean up and remove the old users.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">DROP</span> <span class="fu">USER</span> user_10g;</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">DROP</span> <span class="fu">USER</span> user_11g;</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">DROP</span> <span class="fu">USER</span> user_12c;</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw">DROP</span> <span class="fu">USER</span> user_all;</a></code></pre></div>
<p>Create 4 dedicated test user and grant them <em>CREATE SESSION</em>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">SESSION</span> <span class="kw">TO</span> user_10g <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> manager;</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">SESSION</span> <span class="kw">TO</span> user_11g <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> manager;</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">SESSION</span> <span class="kw">TO</span> user_12c <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> manager;</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw">GRANT</span> <span class="kw">CREATE</span> <span class="kw">SESSION</span> <span class="kw">TO</span> user_all <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> manager;</a></code></pre></div>
<p>Reset all passwords using <em>IDENTIFIED BY VALUES</em> to explicitly set a particular password verifier.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">ALTER</span> <span class="fu">USER</span> user_10g <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> <span class="kw">VALUES</span> <span class="st">&#39;808E79166793CFD1&#39;</span>;</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">ALTER</span> <span class="fu">USER</span> user_11g <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> <span class="kw">VALUES</span> <span class="st">&#39;S:22D8239017006EBDE054108BF367F225B5E731D12C91A3BEB31FA28D4A38&#39;</span>;</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">ALTER</span> <span class="fu">USER</span> user_12c <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> <span class="kw">VALUES</span> <span class="st">&#39;T:C6CE7A88CC5D0E048F32A564D2B6A7BDC78A2092184F28D13A90FC071F80</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">4E5EA09D4D2A3749AA79BFD0A90D18DEC5788D2B8754AE20EE5C309DBA87550E8AA15EAF2746ED431BF4543D2ABE33E22678&#39;</span>;</a></code></pre></div>
<p>See what we do have in <em>dba_users</em>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">set</span> linesize <span class="dv">160</span> pagesize <span class="dv">200</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">col username <span class="kw">for</span> a25</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw">SELECT</span> username,password_versions <span class="kw">FROM</span> dba_users <span class="kw">WHERE</span> username <span class="kw">LIKE</span> <span class="st">&#39;USER_%&#39;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">USERNAME          PASSWORD_VERSIONS</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">------------------------- -----------------</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">USER_10G          10G</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">USER_11G          11G</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">USER_12C          12C</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">USER_ALL          10G 11G 12C</a></code></pre></div>
<p>See what we do have in <em>user$</em>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">set</span> linesize <span class="dv">160</span> pagesize <span class="dv">200</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">col name <span class="kw">for</span> a20</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">col <span class="kw">password</span> <span class="kw">for</span> a20</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">col spare4 <span class="kw">for</span> a65</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw">SELECT</span> name,<span class="kw">password</span>,spare4 <span class="kw">FROM</span> user$ <span class="kw">WHERE</span> name <span class="kw">LIKE</span> <span class="st">&#39;USER_%&#39;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">NAME       <span class="kw">PASSWORD</span>          SPARE4</a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">---------- ----------------- -----------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">USER_10G   <span class="fl">808E79166793</span>CFD1</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">USER_11G                     S<span class="ch">:22D8239017006EBDE054108BF367F225B5E731D12C91A3BEB31FA28D4A38</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">USER_12C                     T<span class="ch">:C6CE7A88CC5D0E048F32A564D2B6A7BDC78A2092184F28D13A90FC071F804E5</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12">                             EA09D4D2A3749AA79BFD0A90D18DEC5788D2B8754AE20EE5C309DBA87550E8AA1</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">                             5EAF2746ED431BF4543D2ABE33E22678</a>
<a class="sourceLine" id="cb7-14" data-line-number="14"></a>
<a class="sourceLine" id="cb7-15" data-line-number="15">USER_ALL   BFD595809B6149CB  S<span class="ch">:804A87EA761505458FDED9B057A77FCF53DA3DDBD6EDB168501EDF5C0B10</span>;T:</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">                             7950DF0D54DEA24F1764EBC34A262D784E18F4292510B8A2E0D0F7ADFEC1C6F1E</a>
<a class="sourceLine" id="cb7-17" data-line-number="17">                             22D841A9D91BAF0B9B05632F6D4898C6F4AE1EEF1509339EBCE261A1F36E834A5</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">                             E2DD9F1E772AB2D6413CCAB5EB0B23</a></code></pre></div>
<p>Check what we do have in <em>sqlnet.ora</em>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb8-1" data-line-number="1">host grep -i ALLOWED /u00/app/oracle/network/admin/sqlnet.ora</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">#SQLNET.ALLOWED_LOGON_VERSION_CLIENT=12a</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">SQLNET.ALLOWED_LOGON_VERSION_SERVER=<span class="dv">11</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">host sed -i <span class="ot">&quot;s|^SQLNET.ALLOWED_LOGON_VERSION_SERVER.*|SQLNET.ALLOWED_LOGON_VERSION_SERVER=11|&quot;</span> \</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    /u00/app/oracle/network/admin/sqlnet.ora</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">host sed -i <span class="ot">&quot;s|^SQLNET.ALLOWED_LOGON_VERSION_SERVER.*|SQLNET.ALLOWED_LOGON_VERSION_SERVER=12|&quot;</span> \</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">    /u00/app/oracle/network/admin/sqlnet.ora</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">host sed -i <span class="ot">&quot;s|^SQLNET.ALLOWED_LOGON_VERSION_SERVER.*|SQLNET.ALLOWED_LOGON_VERSION_SERVER=12a|&quot;</span> \</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">    /u00/app/oracle/network/admin/sqlnet.ora</a></code></pre></div>
<p>Do some login tests</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb9-1" data-line-number="1">SQL&gt; <span class="kw">connect</span> user_10g/manager</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">ERROR:</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">ORA<span class="dv">-01017</span>: invalid username/password; <span class="kw">logon</span> denied</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">Warning: You are <span class="kw">no</span> longer connected <span class="kw">to</span> ORACLE.</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw">connect</span> user_11g/manager</a></code></pre></div>
<h2 id="setup-kerberos">Setup Kerberos</h2>
<p>Check the configuration scripts in <em>sqlnet.ora</em>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="fu">grep</span> -i -A 11 -B 2 <span class="st">&quot;Kerberos Configuration&quot;</span> <span class="va">$TNS_ADMIN</span>/sqlnet.ora</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">##########################################################################</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co"># Kerberos Configuration</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">##########################################################################</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="ex">SQLNET.AUTHENTICATION_SERVICES</span> = (BEQ,KERBEROS5)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#SQLNET.AUTHENTICATION_SERVICES = (ALL)</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="ex">SQLNET.FALLBACK_AUTHENTICATION</span> = TRUE</a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="ex">SQLNET.KERBEROS5_KEYTAB</span> = /u00/app/oracle/network/admin/urania.keytab</a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="ex">SQLNET.KERBEROS5_REALMS</span> = /u00/app/oracle/network/admin/krb.realms</a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="ex">SQLNET.KERBEROS5_CC_NAME</span> = /u00/app/oracle/network/admin/krbcache</a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="ex">SQLNET.KERBEROS5_CONF</span> = /u00/app/oracle/network/admin/krb5.conf</a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="ex">SQLNET.KERBEROS5_CONF_MIT</span>=TRUE</a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="ex">SQLNET.AUTHENTICATION_KERBEROS5_SERVICE</span> = oracle</a></code></pre></div>
<p>Check the configuration scripts in <em>krb5.conf</em>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="fu">cat</span> <span class="va">$TNS_ADMIN</span>/krb5.conf</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">####krb5.conf DB Server</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">[<span class="ex">logging</span>]</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="ex">default</span> = FILE:/u00/app/oracle/network/log/krb5lib.log</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="va">kdc=</span>FILE:/u00/app/oracle/network/log/krb5kdc.log</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="va">admin_server=</span>FILE:/u00/app/oracle/network/log/kadmind.log</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">[<span class="ex">libdefaults</span>]</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"> <span class="ex">default_realm</span> = POSTGASSE.ORG</a>
<a class="sourceLine" id="cb11-11" data-line-number="11"> <span class="va">clockskew=</span>300</a>
<a class="sourceLine" id="cb11-12" data-line-number="12"> <span class="ex">ticket_lifetime</span> = 24h</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"> <span class="ex">renew_lifetime</span> = 7d</a>
<a class="sourceLine" id="cb11-14" data-line-number="14"> <span class="ex">forwardable</span> = true</a>
<a class="sourceLine" id="cb11-15" data-line-number="15"></a>
<a class="sourceLine" id="cb11-16" data-line-number="16">[<span class="ex">realms</span>]</a>
<a class="sourceLine" id="cb11-17" data-line-number="17"> <span class="ex">POSTGASSE.ORG</span> = {</a>
<a class="sourceLine" id="cb11-18" data-line-number="18">   <span class="ex">kdc</span> = mneme.postgasse.org</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">   <span class="ex">admin_server</span> = mneme.postgasse.org</a>
<a class="sourceLine" id="cb11-20" data-line-number="20">}</a>
<a class="sourceLine" id="cb11-21" data-line-number="21"></a>
<a class="sourceLine" id="cb11-22" data-line-number="22">[<span class="ex">domain_realm</span>]</a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="ex">.postgasse.org</span> = POSTGASSE.ORG</a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="ex">postgasse.org</span> = POSTGASSE.ORG</a></code></pre></div>
<p>lookup hostname’s and check DNS configuration</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="fu">cat</span> /etc/resolv.conf</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co"># Generated by NetworkManager</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="ex">search</span> aux.lan postgasse.org</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="ex">nameserver</span> 192.168.56.70</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="ex">nameserver</span> 10.154.0.1</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="ex">nslookup</span> mneme.postgasse.org</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="ex">Server</span>:     192.168.56.70</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="ex">Address</span>:    192.168.56.70#53</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="ex">Name</span>:   mneme.postgasse.org</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="ex">Address</span>: 192.168.56.70</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="ex">Name</span>:   mneme.postgasse.org</a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="ex">Address</span>: 10.0.2.19</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="ex">nslookup</span> te2018_eusdb.postgasse.org</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="ex">Server</span>:     192.168.56.70</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="ex">Address</span>:    192.168.56.70#53</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="ex">Name</span>:   urania.postgasse.org</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="ex">Address</span>: 192.168.56.90</a></code></pre></div>
<p>Create a service principle in MS AD</p>
<p>Create the keytab file</p>
<pre class="batch"><code>ktpass.exe -princ oracle/te2018_eusdb.postgasse.org@POSTGASSE.ORG \
    -mapuser te2018_eusdb.postgasse.org -pass manager \
    -crypto ALL -ptype KRB5_NT_PRINCIPAL \
    -out C:\u00\app\oracle\network\te2018_eusdb.keytab</code></pre>
<p>Connect as kerberos User ## Setup OUD AD Proxy</p>
<h3 id="requirements">Requirements</h3>
<p>Before you can start you may need a few things.</p>
<ul>
<li>Docker environment (eg. Docker community edition)</li>
<li>OUD Docker Images in particular one for OUD 12.2.1.3 with the latest OUD base see <a href="https://github.com/oehrlis/docker">oehrlis/docker</a> soon you may also get the Dockerfiles from the Oracle Repository see <a href="https://github.com/oracle/docker-images/pull/911">pull request 911</a></li>
<li>An MS AD Directory server or at lease a few credential to access one</li>
</ul>
<h3 id="environment-variable">Environment Variable</h3>
<p>To type less you just have to define a few environment variables. Basically you will define the local Docker volume path, container name, container hostname and the OUD instance name.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="bu">export</span> <span class="va">MY_CONTAINER=</span><span class="st">&quot;te2018_oud&quot;</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="bu">export</span> <span class="va">MY_VOLUME_PATH=</span><span class="st">&quot;/data/docker/volumes/</span><span class="va">$MY_CONTAINER</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="bu">export</span> <span class="va">MY_HOST=</span><span class="st">&quot;</span><span class="va">$MY_CONTAINER</span><span class="st">.postgasse.org&quot;</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="bu">export</span> <span class="va">MY_OUD_INSTANCE=</span><span class="st">&quot;oud_adproxy&quot;</span></a></code></pre></div>
<h3 id="create-the-container">Create the container</h3>
<p>Just create a container without starting it. Adjust ports, base DN etc.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="ex">docker</span> container create --name <span class="va">$MY_CONTAINER</span> \</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">    --volume <span class="va">$MY_VOLUME_PATH</span>:/u01 \</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">    -p 1389:1389 -p 1636:1636 -p 4444:4444 \</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">    -e OUD_CUSTOM=TRUE \</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">    -e BASEDN=<span class="st">&quot;dc=postgasse,dc=org&quot;</span> \</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">    -e OUD_INSTANCE=<span class="va">$MY_OUD_INSTANCE</span> \</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">    --hostname <span class="va">$MY_HOST</span> \</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">    --dns 192.168.56.70 \</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">    --dns-search postgasse.org \</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">    oracle/oud:12.2.1.3.180626</a></code></pre></div>
<p>Get and configure your create scripts out of the container from the OUD base. Alternatively you may also get it directly from GitHub <a href="https://github.com/oehrlis/oudbase">oehrlis/oudbase</a>.</p>
<p>Get the OUD EUS AD templates from the Docker container created before.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="fu">mkdir</span> -p <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="ex">docker</span> cp \</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">    <span class="va">$(</span><span class="ex">docker</span> ps -aqf <span class="st">&quot;name=</span><span class="va">$MY_CONTAINER</span><span class="st">&quot;</span><span class="va">)</span>:/u00/app/oracle/local/oudbase/templates/create/oud12c_eus_ad_proxy \</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="fu">mv</span> <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/oud12c_eus_ad_proxy <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create</a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="fu">mkdir</span> -p <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/etc</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="bu">echo</span> <span class="st">&quot;manager&quot;</span> <span class="op">&gt;</span><span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/etc/<span class="va">${MY_OUD_INSTANCE}</span>_pwd.txt</a></code></pre></div>
<p>Update the <em>00_init_environment</em> according to your environment. In particular the variables AD_PDC_HOST,AD_PDC_PORT, AD_PDC_USER, AD_PDC_PASSWORD and BASEDN, GROUP_DN, USER_DN</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="ex">vi</span> <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="fu">sed</span> -i -e <span class="st">&quot;s|&lt;PDC_HOSTNAME&gt;|mneme.postgasse.org|g&quot;</span> \</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="fu">sed</span> -i -e <span class="st">&#39;s|&lt;USER_DN&gt;|CN=OUD\\ Admin,CN=Users,dc=postgasse,dc=org|g&#39;</span> \</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="fu">sed</span> -i -e <span class="st">&quot;s|&lt;PASSWORD&gt;|manager|g&quot;</span> \</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-9" data-line-number="9"></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="fu">sed</span> -i -e <span class="st">&#39;s|^export BASEDN.*|export BASEDN=&quot;dc=postgasse,dc=org&quot;|g&#39;</span> \</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="fu">sed</span> -i -e <span class="st">&#39;s|^export GROUP_OU.*|export GROUP_OU=&quot;ou=Groups,dc=postgasse,dc=org&quot;|g&#39;</span> \</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="fu">sed</span> -i -e <span class="st">&#39;s|^export USER_OU.*|export USER_OU=&quot;ou=People,dc=postgasse,dc=org&quot;|g&#39;</span> \</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="fu">sed</span> -i -e <span class="st">&quot;s|dc=example,dc=com|dc=postgasse,dc=org|g&quot;</span> \</a>
<a class="sourceLine" id="cb19-17" data-line-number="17">    <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a>
<a class="sourceLine" id="cb19-18" data-line-number="18"></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="fu">cat</span> <span class="va">$MY_VOLUME_PATH</span>/admin/<span class="va">$MY_OUD_INSTANCE</span>/create/00_init_environment</a></code></pre></div>
<p>Lets go. Start the container and let the scripts create the OUD instance.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="ex">docker</span> start <span class="va">$MY_CONTAINER</span></a></code></pre></div>
<p>Enjoy the log and see how your OUD EUS AD proxy is created</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="ex">docker</span> logs -f <span class="va">$MY_CONTAINER</span></a></code></pre></div>
<h2 id="setup-eus">Setup EUS</h2>
<!-- Register an Oracle Database using DBCA -->
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="ex">dbca</span> -configureDatabase -sourceDB <span class="va">$ORACLE_SID</span> -registerWithDirService true \</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">    -dirServiceUserName <span class="st">&quot;cn=eusadmin&quot;</span> -dirServicePassword manager \</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">    -walletPassword TVD04manager -silent</a></code></pre></div>
<p>Create a global DB User</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">DROP</span> <span class="fu">USER</span> eus_users;</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw">CREATE</span> <span class="fu">USER</span> eus_users <span class="kw">IDENTIFIED</span> <span class="kw">GLOBALLY</span>;  </a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="kw">GRANT</span> tvd_connect <span class="kw">TO</span> eus_users;  </a></code></pre></div>
<p>Define a EUS mapping to the shared schema created before</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="ex">eusm</span> createMapping database_name=<span class="st">&quot;</span><span class="va">$ORACLE_SID</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">    realm_dn=<span class="st">&quot;dc=postgasse,dc=org&quot;</span> map_type=SUBTREE \</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">    map_dn=<span class="st">&quot;ou=People,dc=postgasse,dc=org&quot;</span> schema=EUS_USERS \</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">    ldap_host=<span class="st">&quot;te2018_oud.postgasse.org&quot;</span> ldap_port=1389 ldap_user_dn=<span class="st">&quot;cn=eusadmin&quot;</span> \</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">    ldap_user_password=<span class="st">&quot;manager&quot;</span>  </a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="ex">eusm</span> listMappings database_name=<span class="st">&quot;</span><span class="va">$ORACLE_SID</span><span class="st">&quot;</span> \</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">    realm_dn=<span class="st">&quot;dc=postgasse,dc=org&quot;</span> \</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">    ldap_host=<span class="st">&quot;te2018_oud.postgasse.org&quot;</span> ldap_port=1389 ldap_user_dn=<span class="st">&quot;cn=eusadmin&quot;</span> \</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">    ldap_user_password=<span class="st">&quot;manager&quot;</span></a></code></pre></div>
<p>Passwords are in docker logs or in the password files in <span class="math inline"><em>M</em><em>Y</em><sub><em>V</em></sub><em>O</em><em>L</em><em>U</em><em>M</em><em>E</em><sub><em>P</em></sub><em>A</em><em>T</em><em>H</em>/<em>a</em><em>d</em><em>m</em><em>i</em><em>n</em>/</span>MY_OUD_INSTANCE/etc</p>
<p>check EUS connection</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb26-1" data-line-number="1">SQL&gt; conn dinu/manager</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">Connected.</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">SQL&gt; @sousrinf</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="kw">Database</span> Information</a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co">--------------------</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6">- DB_NAME       : TDB122A</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">- DB_DOMAIN     :</a>
<a class="sourceLine" id="cb26-8" data-line-number="8">- <span class="kw">INSTANCE</span>      : <span class="dv">1</span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9">- INSTANCE_NAME     : TDB122A</a>
<a class="sourceLine" id="cb26-10" data-line-number="10">- SERVER_HOST       : urania</a>
<a class="sourceLine" id="cb26-11" data-line-number="11">-</a>
<a class="sourceLine" id="cb26-12" data-line-number="12">Authentification Information</a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="co">----------------------------</span></a>
<a class="sourceLine" id="cb26-14" data-line-number="14">- SESSION_USER      : EUS_USERS</a>
<a class="sourceLine" id="cb26-15" data-line-number="15">- PROXY_USER        :</a>
<a class="sourceLine" id="cb26-16" data-line-number="16">- AUTHENTICATION_METHOD : <span class="kw">PASSWORD</span></a>
<a class="sourceLine" id="cb26-17" data-line-number="17">- IDENTIFICATION_TYPE   : <span class="kw">GLOBAL</span> <span class="kw">SHARED</span></a>
<a class="sourceLine" id="cb26-18" data-line-number="18">- NETWORK_PROTOCOL  :</a>
<a class="sourceLine" id="cb26-19" data-line-number="19">- OS_USER       : oracle</a>
<a class="sourceLine" id="cb26-20" data-line-number="20">- AUTHENTICATED_IDENTITY: DINU</a>
<a class="sourceLine" id="cb26-21" data-line-number="21">- ENTERPRISE_IDENTITY   : cn=Martin Berger,ou=People,dc=postgasse,dc=org</a>
<a class="sourceLine" id="cb26-22" data-line-number="22">-</a>
<a class="sourceLine" id="cb26-23" data-line-number="23">Other Information</a>
<a class="sourceLine" id="cb26-24" data-line-number="24"><span class="co">-----------------</span></a>
<a class="sourceLine" id="cb26-25" data-line-number="25">- ISDBA         : <span class="kw">FALSE</span></a>
<a class="sourceLine" id="cb26-26" data-line-number="26">- CLIENT_INFO       :</a>
<a class="sourceLine" id="cb26-27" data-line-number="27">- PROGRAM       : sqlplus@urania (TNS V1-V3)</a>
<a class="sourceLine" id="cb26-28" data-line-number="28">- MODULE        : SQL*Plus</a>
<a class="sourceLine" id="cb26-29" data-line-number="29">- IP_ADDRESS        :</a>
<a class="sourceLine" id="cb26-30" data-line-number="30">- SID           : <span class="dv">33</span></a>
<a class="sourceLine" id="cb26-31" data-line-number="31">- SERIAL#       : <span class="dv">17568</span></a>
<a class="sourceLine" id="cb26-32" data-line-number="32">- SERVER        : DEDICATED</a>
<a class="sourceLine" id="cb26-33" data-line-number="33">- TERMINAL      : pts/<span class="dv">1</span></a>
<a class="sourceLine" id="cb26-34" data-line-number="34"></a>
<a class="sourceLine" id="cb26-35" data-line-number="35">PL/SQL <span class="kw">procedure</span> successfully completed.</a></code></pre></div>
